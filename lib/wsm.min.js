WSM=function(a,b){function i(){var a;a="https:"===location.protocol?"wss":"ws",c.ws=new WebSocket(a+"://"+location.hostname+":"+location.port),c.ws.onopen=function(a){c.send("connected","WSM: Browser confirms websocket connection."),d(c)},c.ws.onmessage=function(a){c.processMessage(JSON.parse(a.data))},c.ws.onclose=function(a){i()}}var e,c=this,d=function(a){},f=Array.prototype.slice.call(arguments);0===f.length||(f.length>2?console.error("WSM only takes TWO arguments"):f.forEach(function(a){"function"==typeof a?d=a:e||null==a||"object"!=typeof a||(e=a)}));var g={};if(this.wss,this.ws,this.broadcast=function(a,b){isNode?console.log("server never got any client yet."):console.log("client is not able to broadcast.")},isNode){"object"!=typeof e&&console.error('WSM does not receive enough info to build. Either "{server:server}" or "{port:8080}" should pass as an argument.');var h=require("ws");c.wss=new h.Server(e),c.wss&&console.log("create a WebSocket server."),c.wss.on("connection",function(b){console.log(b._socket.remoteAddress+" connected through websocket at "+(new Date).toLocaleString("en-us",{timeZone:"America/New_York"})),c.ws=b,d(c),c.ws.on("message",function(b){c.processMessage(JSON.parse(b))}),c.send("connected","WSM: Server confirms websocket connection."),c.broadcast=function(a,b){var d={};d.type=a,d.content=b,c.wss.clients.length>0&&c.wss.clients.forEach(function(a){a.send(JSON.stringify(d))})},c.wss.broadcast=c.broadcast})}else i();this.addHandler=function(a,b){g[a]=b},this.deleteHandler=function(a){return"undefined"!=typeof g[a]&&(delete g[a],!0)},this.handlerList=function(){return Object.keys(g)},this.processMessage=function(a){g[a.type](a)},this.send=function(a,b){var d={};d.type=a,d.content=b,c.ws.send(JSON.stringify(d))},this.addHandler("connected",function(a){console.log(a.content)}),this.addHandler("any",function(a){console.log(a.content)})};var isNode=!("undefined"==typeof process||!process.versions||!process.versions.node);isNode&&(module.exports=WSM);
